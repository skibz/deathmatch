<!DOCTYPE html>
<html lang="en">

  <head>
    <link rel="stylesheet" href="css/app.css">
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>deathmat.ch</title>
    <meta name="description" content="deathmat.ch">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  </head>

  <body>

    <noscript>
      <p>Hmm...</p>
      <p>I doubt you'll have much fun here without JavaScript enabled.</p>
    </noscript>

    <nav class="nav">
      <header class="mast">
        <h1>deathmat.ch</h1>
        <h5>Start a fight.</h5>
      </header>

    </nav>

    <main class="main messages"></main>

    <form id="message-form" class="chat-input">
      <div class="chat-commands">
        <button class="chat-command">!add</button>
        <button class="chat-command">!rem</button>
        <button class="chat-command">!status</button>
        <button class="chat-command">!lastgame</button>
        <button class="chat-command">!topmaps</button>
        <button class="chat-command">!topplayers</button>
      </div>

      <textarea id="message-input" class="message-input" rows="5" placeholder="Type message here..."></textarea>
      <input class="chat-input-submit" type="submit" value="Send Message">
    </form>

    <script src="js/app.js"></script>
    <script src="/socket.io/socket.io.js"></script>
    <script>

      'use strict';

      var socket = io(),
          messageForm = one('#message-form'),
          main = one('main'),
          lastMessage;

      socket.on('chat message acknowledged', function() {
        console.log('server received message - updating chat stream');
        var div = document.createElement('div');
        var p = document.createElement('p');
        p.textContent = lastMessage;
        lastMessage = '';
        div.classList.add('message-parent');
        p.classList.add('message');
        div.appendChild(p);
        main.appendChild(div);
      });

      messageForm.onsubmit = function(e) {
        e.preventDefault();
        lastMessage = escapeHtml(one('#message-input').value);
        socket.emit('chat message', lastMessage);
        messageForm.reset();
      };
    </script>
  </body>
</html>
